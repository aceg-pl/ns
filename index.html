<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RSS Mix Viewer</title>
<style>
  body{margin:0;font-family:-apple-system,system-ui,Arial;}
</style>
</head>
<body>
<script>
(function(){
  if(window.__rssMix){ window.__rssMix.remove(); window.__rssMix=null; }

  const container=document.createElement('div'); 
  container.id='__rssMix';
  Object.assign(container.style,{
    position:'fixed',top:'10px',left:'10px',right:'10px',bottom:'10px',
    background:'rgba(255,255,255,0.97)',zIndex:999999,fontFamily:'-apple-system,system-ui,Arial',
    overflow:'auto',padding:'10px',border:'1px solid #ccc',borderRadius:'8px'
  });

  const header=document.createElement('div');
  header.style.display='flex';header.style.justifyContent='space-between';
  header.style.flexWrap='wrap';header.style.alignItems='center';header.style.marginBottom='8px';

  const title=document.createElement('div'); title.innerHTML='<b>📰 News</b>';

  const icons=document.createElement('div'); icons.style.textAlign='center'; icons.style.flexGrow='1';
  const sites=[
    {url:'https://www.onet.pl', domain:'onet.pl'},
    {url:'https://www.wp.pl', domain:'wp.pl'},
    {url:'https://www.interia.pl', domain:'interia.pl'},
    {url:'https://www.gazeta.pl', domain:'gazeta.pl'}
  ];
  sites.forEach((site,i)=>{
    const img=document.createElement('img');
    img.src=`https://www.google.com/s2/favicons?domain=${site.domain}&sz=24`;
    img.width=24; img.height=24; img.style.verticalAlign='middle'; img.style.margin='0 6px';
    img.style.cursor='pointer'; img.onclick=()=>window.open(site.url,'_blank');
    icons.appendChild(img); if(i<sites.length-1) icons.appendChild(document.createTextNode('•'));
  });

  const closeBtn=document.createElement('button');
  closeBtn.textContent='❌';
  closeBtn.style.fontWeight='bold'; closeBtn.style.fontSize='18px'; closeBtn.style.border='none'; closeBtn.style.background='none';
  closeBtn.onclick=()=>container.remove();

  header.appendChild(title); header.appendChild(icons); header.appendChild(closeBtn);

  const list=document.createElement('div'); list.id='rssList'; list.style.display='grid'; list.style.gap='8px';
  function resizeGrid(){
    const w=window.innerWidth;
    list.style.gridTemplateColumns=w<500?'repeat(2,1fr)': w>window.innerHeight?'repeat(4,1fr)':'repeat(3,1fr)';
  }
  resizeGrid(); window.addEventListener('resize',resizeGrid);

  container.appendChild(header); container.appendChild(list); document.body.appendChild(container);
  window.__rssMix=container;

  const feeds=[
    'https://wiadomosci.onet.pl/.feed',
    'https://wiadomosci.gazeta.pl/pub/rss/wiadomosci.htm',
    'https://www.polsatnews.pl/rss/wszystkie.xml',
    'https://wiadomosci.wp.pl/rss.xml',
    'https://feeds.bbci.co.uk/polska/rss.xml',
    'https://wydarzenia.interia.pl/feed'
  ];

  const proxy='https://api.allorigins.win/get?url='; // CORS proxy
  const items=[];

  Promise.all(feeds.map(feedURL =>
    fetch(proxy + encodeURIComponent(feedURL))
      .then(r=>r.json())
      .then(data=>{
        const parser=new DOMParser();
        const xml=parser.parseFromString(data.contents,"application/xml");
        const entries=Array.from(xml.querySelectorAll("item, entry"));
        entries.forEach(e=>{
          items.push({
            title:e.querySelector("title")?.textContent || "No title",
            link:e.querySelector("link")?.textContent || e.querySelector("link")?.getAttribute("href") || "#",
            date:e.querySelector("pubDate")?.textContent || e.querySelector("updated")?.textContent || new Date().toISOString()
          });
        });
      }).catch(()=>{})
  )).then(()=>{
    items.sort((a,b)=>new Date(b.date)-new Date(a.date));
    list.innerHTML='';
    items.slice(0,100).forEach(e=>{
      const entry=document.createElement('div');
      entry.style.border='1px solid #ddd'; entry.style.padding='6px'; entry.style.borderRadius='6px';
      entry.style.background='#fff'; entry.style.fontSize='13px'; entry.style.height='60px'; entry.style.overflow='hidden';
      const a=document.createElement('a'); a.href=e.link; a.target='_blank'; a.style.color='#007aff'; a.style.textDecoration='none';
      const img=document.createElement('img'); img.src=`https://www.google.com/s2/favicons?domain=${new URL(e.link).hostname}&sz=16`;
      img.width=12; img.height=12; img.style.verticalAlign='middle'; img.style.marginRight='4px';
      let tText=e.title.split(' ').slice(0,14).join(' '); if(e.title.split(' ').length>14) tText+='…';
      const span=document.createElement('span'); span.style.color='#666';
      const r=new Date(e.date), d=new Date(); span.textContent=' '+((d-r)/36e5<24 ? `${String(r.getHours()).padStart(2,'0')}:${String(r.getMinutes()).padStart(2,'0')}` : `${String(r.getDate()).padStart(2,'0')}/${String(r.getMonth()+1).padStart(2,'0')}`);
      a.appendChild(img); a.appendChild(document.createTextNode(tText)); a.appendChild(span); entry.appendChild(a); list.appendChild(entry);
    });
  });

})();
</script>
<p>The RSS overlay should appear above. Click the icons to open the news sites.</p>
</body>
</html>
